{"filter":false,"title":"app.js","tooltip":"/YelpCamp/v7/app.js","undoManager":{"mark":12,"position":12,"stack":[[{"start":{"row":11,"column":49},"end":{"row":11,"column":50},"action":"remove","lines":["6"],"id":2}],[{"start":{"row":11,"column":49},"end":{"row":11,"column":50},"action":"insert","lines":["7"],"id":3}],[{"start":{"row":15,"column":0},"end":{"row":15,"column":3},"action":"remove","lines":["// "],"id":4}],[{"start":{"row":15,"column":0},"end":{"row":15,"column":3},"action":"insert","lines":["// "],"id":5}],[{"start":{"row":9,"column":37},"end":{"row":10,"column":0},"action":"insert","lines":["",""],"id":6},{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":10,"column":0},"end":{"row":10,"column":4},"action":"remove","lines":["    "],"id":7}],[{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":8}],[{"start":{"row":11,"column":0},"end":{"row":14,"column":48},"action":"insert","lines":["//requring routes","var commentRoutes    = require(\"./routes/comments\"),","    campgroundRoutes = require(\"./routes/campgrounds\"),","    indexRoutes      = require(\"./routes/index\")"],"id":9}],[{"start":{"row":14,"column":48},"end":{"row":15,"column":0},"action":"insert","lines":["",""],"id":10},{"start":{"row":15,"column":0},"end":{"row":15,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":14,"column":48},"end":{"row":14,"column":49},"action":"insert","lines":[";"],"id":11}],[{"start":{"row":10,"column":0},"end":{"row":11,"column":0},"action":"insert","lines":["",""],"id":12}],[{"start":{"row":42,"column":0},"end":{"row":184,"column":0},"action":"remove","lines":["//","app.get(\"/\", function(req, res){","    res.render(\"landing\");","});","","// index: show list of all campgrounds","app.get(\"/campgrounds\", function(req, res){","    // Get all campgrounds from DB","    Campground.find({}, function(err, allCampgrounds){","      if(err){","          console.log(err);","      } else {","          res.render(\"campgrounds/index\",{campgrounds:allCampgrounds});","      }","    });","});","","// create new campground","app.get(\"/campgrounds/new\", function(req, res){","    res.render(\"campgrounds/new\");","});","","","app.post(\"/campgrounds\", function(req, res){","    // get data from form and add to campgrounds array","    var name = req.body.name;","    var image = req.body.image;","    var desc = req.body.description;","    var newCampground = {name: name, image: image, description: desc}","    // Create a new campground and save to DB","    Campground.create(newCampground, function(err, newlyCreated){","        if(err){","            console.log(err);","        } else {","            //redirect back to campgrounds page","            res.redirect(\"/campgrounds\");","        }","    });","});","","","// SHOW - shows more info about one campground","app.get(\"/campgrounds/:id\", function(req, res){","    //find the campground with provided ID","    Campground.findById(req.params.id).populate(\"comments\").exec(function(err, foundCampground){","        if (err) {","            console.log(err);","        } else {","            //render show template with that campground","            res.render(\"campgrounds/show\", {campground: foundCampground});","        }","    });","})","","// ====================","// COMMENTS ROUTES","// ====================","// create a comment","app.get(\"/campgrounds/:id/comments/new\", isLoggedIn, function(req, res){","    // find campground by id","    Campground.findById(req.params.id, function(err, campground){","        if(err){","            console.log(err);","        } else {","             res.render(\"comments/new\", {campground: campground});","        }","    })","});","","// ","app.post(\"/campgrounds/:id/comments\", isLoggedIn, function(req, res){","    //lookup campground using ID","    Campground.findById(req.params.id, function(err, campground){","        if(err){","           console.log(err);","           res.redirect(\"/campgrounds\");","        } else {","           Comment.create(req.body.comment, function(err, comment){","               if(err){","                    console.log(err);","                } else {","                    campground.comments.push(comment);","                    campground.save();","                    res.redirect('/campgrounds/' + campground._id);","                }","            });","        }","   });","   //create new comment","   //connect new comment to campground","   //redirect campground show page","});","","","//  ===========","// AUTH ROUTES","//  ===========","","// show register form","app.get(\"/register\", function(req, res){","   res.render(\"register\"); ","});","//handle sign up logic","app.post(\"/register\", function(req, res){","    var newUser = new User({username: req.body.username});","    User.register(newUser, req.body.password, function(err, user){","        if(err){","            console.log(err);","            return res.render(\"register\");","        }","        passport.authenticate(\"local\")(req, res, function(){","           res.redirect(\"/campgrounds\"); ","        });","    });","});","","","// show login form","app.get(\"/login\", function(req, res){","   res.render(\"login\"); ","});","// handling login logic","app.post(\"/login\", passport.authenticate(\"local\", ","    {","        successRedirect: \"/campgrounds\",","        failureRedirect: \"/login\"","    }), function(req, res){","});","","// logic route","app.get(\"/logout\", function(req, res){","   req.logout();","   res.redirect(\"/campgrounds\");","});","","//","function isLoggedIn(req, res, next){","    if(req.isAuthenticated()){","        return next();","    }","    res.redirect(\"/login\");","}",""],"id":13}],[{"start":{"row":43,"column":0},"end":{"row":45,"column":52},"action":"insert","lines":["app.use(\"/\", indexRoutes);","app.use(\"/campgrounds\", campgroundRoutes);","app.use(\"/campgrounds/:id/comments\", commentRoutes);"],"id":14}]]},"ace":{"folds":[],"scrolltop":75,"scrollleft":0,"selection":{"start":{"row":15,"column":16},"end":{"row":15,"column":16},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":3,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1558129642985,"hash":"f9b1d0f0f205242e2379382f9f831d1fb64a6291"}