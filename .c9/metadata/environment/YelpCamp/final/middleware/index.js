{"filter":false,"title":"index.js","tooltip":"/YelpCamp/final/middleware/index.js","undoManager":{"mark":10,"position":10,"stack":[[{"start":{"row":1,"column":43},"end":{"row":2,"column":0},"action":"insert","lines":["",""],"id":13}],[{"start":{"row":2,"column":0},"end":{"row":2,"column":41},"action":"insert","lines":["var Review = require(\"../models/review\");"],"id":14}],[{"start":{"row":60,"column":1},"end":{"row":61,"column":0},"action":"insert","lines":["",""],"id":15},{"start":{"row":61,"column":0},"end":{"row":62,"column":0},"action":"insert","lines":["",""]},{"start":{"row":62,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["",""]},{"start":{"row":63,"column":0},"end":{"row":64,"column":0},"action":"insert","lines":["",""]},{"start":{"row":64,"column":0},"end":{"row":65,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":63,"column":0},"end":{"row":107,"column":2},"action":"insert","lines":["middlewareObj.checkReviewOwnership = function(req, res, next) {","    if(req.isAuthenticated()){","        Review.findById(req.params.review_id, function(err, foundReview){","            if(err || !foundReview){","                res.redirect(\"back\");","            }  else {","                // does user own the comment?","                if(foundReview.author.id.equals(req.user._id)) {","                    next();","                } else {","                    req.flash(\"error\", \"You don't have permission to do that\");","                    res.redirect(\"back\");","                }","            }","        });","    } else {","        req.flash(\"error\", \"You need to be logged in to do that\");","        res.redirect(\"back\");","    }","};","","middlewareObj.checkReviewExistence = function (req, res, next) {","    if (req.isAuthenticated()) {","        Campground.findById(req.params.id).populate(\"reviews\").exec(function (err, foundCampground) {","            if (err || !foundCampground) {","                req.flash(\"error\", \"Campground not found.\");","                res.redirect(\"back\");","            } else {","                // check if req.user._id exists in foundCampground.reviews","                var foundUserReview = foundCampground.reviews.some(function (review) {","                    return review.author.id.equals(req.user._id);","                });","                if (foundUserReview) {","                    req.flash(\"error\", \"You already wrote a review.\");","                    return res.redirect(\"/campgrounds/\" + foundCampground._id);","                }","                // if the review was not found, go to the next middleware","                next();","            }","        });","    } else {","        req.flash(\"error\", \"You need to login first.\");","        res.redirect(\"back\");","    }","};"],"id":16}],[{"start":{"row":83,"column":0},"end":{"row":84,"column":0},"action":"insert","lines":["",""],"id":17}],[{"start":{"row":118,"column":1},"end":{"row":118,"column":2},"action":"insert","lines":[";"],"id":18}],[{"start":{"row":60,"column":1},"end":{"row":60,"column":2},"action":"insert","lines":[";"],"id":19}],[{"start":{"row":33,"column":1},"end":{"row":33,"column":2},"action":"insert","lines":[";"],"id":20}],[{"start":{"row":34,"column":0},"end":{"row":35,"column":0},"action":"insert","lines":["",""],"id":21}],[{"start":{"row":71,"column":61},"end":{"row":71,"column":62},"action":"insert","lines":[" "],"id":22}],[{"start":{"row":71,"column":62},"end":{"row":71,"column":81},"action":"insert","lines":["|| req.user.isAdmin"],"id":23}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":71,"column":81},"end":{"row":71,"column":81},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1558399384983,"hash":"e368d126be57578d5bbd28ff08e9af8fa7ba6585"}